<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¨ºæ–­å±¥æ­´ - MBTIæ–‡å­¦çš„è¨ºæ–­</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
  background: #f7f7f9;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 900px;
  margin: 40px auto;
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
h1 {
  text-align: center;
  color: #333;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 10px;
  text-align: center;
}
th {
  background-color: #f0f0f0;
}
canvas {
  margin-top: 40px;
}
button {
  display: block;
  margin: 20px auto;
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: #007aff;
  color: white;
  cursor: pointer;
}
button:hover { background: #005fcc; }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ“œ è¨ºæ–­å±¥æ­´</h1>
  <p>ã‚ãªãŸãŒã“ã‚Œã¾ã§ã«å®Ÿæ–½ã—ãŸMBTIæ–‡å­¦çš„è¨ºæ–­ã®è¨˜éŒ²ã§ã™ã€‚</p>

  <table id="history-table">
    <thead>
      <tr>
        <th>æ—¥ä»˜</th>
        <th>ã‚¿ã‚¤ãƒ—</th>
        <th>å‰¥é›¢åº¦ï¼ˆ%ï¼‰</th>
      </tr>
    </thead>
    <tbody id="history-body">
      <tr><td colspan="3">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>
    </tbody>
  </table>

  <canvas id="historyChart"></canvas>

  <button onclick="clearHistory()">å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹</button>
  <button onclick="window.location.href='index.html'">è¨ºæ–­ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</button>
</div>

<script>
function loadHistory() {
  const history = JSON.parse(localStorage.getItem("mbti_history")) || [];
  const body = document.getElementById("history-body");
  body.innerHTML = "";

  if (history.length === 0) {
    body.innerHTML = "<tr><td colspan='3'>å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>";
    return;
  }

  history.forEach(item => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${item.date}</td>
      <td>${item.type}</td>
      <td>${item.divergence}%</td>
    `;
    body.appendChild(row);
  });

  // ã‚°ãƒ©ãƒ•æç”»
  const ctx = document.getElementById('historyChart').getContext('2d');
  const labels = history.map(h => h.date);
  const divergences = history.map(h => h.divergence);

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'å‰¥é›¢åº¦ã®æ¨ç§»',
        data: divergences,
        borderColor: '#007aff',
        backgroundColor: 'rgba(0, 122, 255, 0.2)',
        tension: 0.2,
        fill: true
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          title: { display: true, text: "å‰¥é›¢åº¦ (%)" }
        },
        x: {
          title: { display: true, text: "æ—¥ä»˜" }
        }
      }
    }
  });
}

function clearHistory() {
  if (confirm("æœ¬å½“ã«å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
    localStorage.removeItem("mbti_history");
    alert("å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
    location.reload();
  }
}

loadHistory();
</script>
</body>
</html>
